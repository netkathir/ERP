name: FTP Deploy (cURL)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Upload Files via Curl
      run: |
        echo "Starting Deployment..."

        # Local directory containing files to upload
        LOCAL_DIR="/home2/whyceffy/public_html"

        # Remote directory path on server
        REMOTE_DIR="/custom_erp"

        # Loop through all files under public_html
        for FILE in $(find "$LOCAL_DIR" -type f); do

          # Build the remote destination path
          REMOTE_PATH="$REMOTE_DIR${FILE#$LOCAL_DIR/}"

          echo "Uploading: $FILE â†’ $REMOTE_PATH"

          # Upload via FTP
          curl -T "$FILE" \
            "ftp://${{ secrets.FTP_SERVER }}$REMOTE_PATH" \
            --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}"
        done

        echo "Deployment completed!"
