name: FTP Deploy (cURL)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Upload Files via Curl
      run: |
        echo "Starting Deployment..."

        # Local directory containing files to upload
        LOCAL_DIR="./public"
        REMOTE_DIR="/public_html/custom_erp/"

        # Debugging output
        echo "FTP Server: ${{ secrets.FTP_SERVER }}"
        echo "FTP Username: ${{ secrets.FTP_USERNAME }}"
        echo "Remote Directory: $REMOTE_DIR"

        find "$LOCAL_DIR" -type f | while read FILE; do
            REMOTE_PATH="$REMOTE_DIR${FILE#$LOCAL_DIR/}"
            echo "Uploading: $FILE â†’ $REMOTE_PATH"
            curl -v -T "$FILE" "ftps://${{ secrets.FTP_SERVER }}$REMOTE_PATH" \
                --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
                --ftp-ssl --ssl-reqd
        done
